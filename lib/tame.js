/*!
 * TAME [TwinCAT ADS Made Easy] V4.0 160317
 * 
 * Copyright (c) 2009-2016 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={version:"V4.0 160317",weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(e){function j(ar){try{window.console.log(ar)}catch(at){alert(ar)}}j("TAME library version: "+TAME.version);var ac=this,k={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,HandleByName:61443,ValueByHandle:61445,ReleaseHandle:61446,SumRd:61568,SumWr:61569,SumRdWr:61570},C={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},V=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],f=(typeof e.language==="string")?e.language:"ge",l=(function(){var ar={},au="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at;for(at=0;at<au.length;at++){ar[at]=au.charAt(at)}return ar}()),o=(function(){var ar={},au="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",at;for(at=0;at<au.length;at++){ar[au.charAt(at)]=at}return ar}()),a=0,F=[0],R={},aq={},A={},b=0,v=0,O={},r=[];if(typeof e.serviceUrl!=="string"){j("TAME library error: Service URL is not a string!");return}if(typeof e.amsNetId!=="string"&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){j("TAME library error: NetId is not defined and there is no URL for fetching the TPY file or fetching the symbols is deactivated!");return}if(e.amsPort===undefined&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){e.amsPort="801";j("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof e.amsPort==="number"){j("TAME library warning: AMS port number is not a string! Trying to convert it.");e.amsPort=e.amsPort.toString(10)}}if(parseInt(e.amsPort,10)<801||parseInt(e.amsPort,10)>891){j("TAME library error: AMS Port Number ("+parseInt(e.amsPort,10)+") is out of range (801-891)!");return}if(e.dataAlign4===true){a=4}else{if(e.alignment===undefined&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){a=1}else{if(typeof e.alignment==="string"){a=parseInt(e.alignment,10)}else{if(typeof e.alignment==="number"){a=e.alignment}}}}if(e.syncXmlHttp===true){j('TAME library info: The "syncXmlHttp" parameter is set to true. Synchronous XMLHttpRequests will be used by default.')}else{e.syncXmlHttp===false}if(typeof e.serviceUser==="string"&&typeof e.servicePassword==="string"){j("TAME library info: Username and password set. Authenticated requests will be used.")}else{e.serviceUser=null;e.servicePassword=null}if(e.useHandles===true){j('TAME library info: The "useHandles" parameter is set to true. Handles will be used by default.')}this.dateNames={weekdShort:TAME.weekdShortNames[f],weekdLong:TAME.weekdLongNames[f],monthsShort:TAME.monthsShortNames[f],monthsLong:TAME.monthsLongNames[f]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;this.symTableReady=false;this.dataTypeTableReady=false;this.handleCacheReady=false;function B(ar,av,au,ax,aA){var aw=[],az=0,ay=[],at=0;if(typeof ar==="number"){aw[0]=ar.toString(10)}else{if(typeof ar==="string"){aw=ar.split(".")}else{j("TAME library error: Can't parse name of object/variable. Name is not a string or number!");j(ar);return}}if(au===undefined){au=window}az=aw.length-1;while(at<az){if(aw[at].charAt(aw[at].length-1)==="]"){ay=aw[at].substring(0,aw[at].length-1).split("[");au=au[ay[0]][ay[1]]}else{if(au[aw[at]]===undefined){au[aw[at]]=[]}au=au[aw[at]]}at++}if(aw[at].charAt(aw[at].length-1)==="]"){ay=aw[at].substring(0,aw[at].length-1).split("[");au=au[ay[0]];if(av!==undefined){if(typeof ax==="string"){av=ax+av}if(typeof aA==="string"){av=av+aA}au[ay[1]]=av}return au[ay[1]]}if(av!==undefined){if(typeof ax==="string"){av=ax+av}if(typeof aA==="string"){av=av+aA}au[aw[at]]=av}return au[aw[at]]}function ao(ar){if(ar===undefined){return false}if(!isNaN(ar)&&ar>0&&ar<=ac.maxStringLen){return true}j("TAME library error: User defined string length not valid! length: "+ar);j("Max. string length: "+ac.maxStringLen);return false}function z(at){var ar;if(at.addr){if(typeof at.addr==="string"&&at.addr.charAt(0)==="%"){if(at.addr.charAt(2)==="X"){ar=k[at.addr.substr(1,2)]}else{ar=k[at.addr.substr(1,1)]}}else{j('TAME library error: Wrong address definition, should be a string and start with "%"!');j(at);return}}else{if(at.useHandle===true||e.useHandles===true&&at.useHandle!==false){ar=k.ValueByHandle}else{if(at.symbolName){if(typeof at.symbolName==="string"){try{ar=R[at.symbolName].indexGroup}catch(au){j("TAME library error: Can't get the IndexGroup for this request!");j("TAME library error: Please check the variable name.");j(au);j(at);return}}else{j("TAME library error: Varible name should be a string!");j(at);return}}else{j("TAME library error: No name, address or handle for the variable/request defined!");j(at);return}}}if(isNaN(ar)){j("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");j(at)}return ar}function i(ay){var av,at="",ax=[],au,aA,ar,az,aC,aB;if(ay.addr){if(typeof ay.addr==="string"&&ay.addr.charAt(0)==="%"){if(ay.addr.charAt(2)==="X"){at=ay.addr.substr(3);ax=at.split(".");av=parseInt(ax[0],10)*8+parseInt(ax[1],10)}else{av=parseInt(ay.addr.substr(3),10);if(typeof ay.addrOffset==="number"){av+=ay.addrOffset}}}else{j('TAME library error: Wrong address definition, should be a string and start with "%"!');j(ay);return}}else{if(ay.useHandle===true||e.useHandles===true&&ay.useHandle!==false){if(ac.handleCacheReady===true){av=O[ay.fullSymbolName];if(isNaN(av)){j("TAME library error: Could not get the handle for this symbol name: "+ay.fullSymbolName);j(ay);return}}else{j("TAME library error: Could not get the handle for this request. Handle cache is not ready.");j(ay);return}}else{if(ay.symbolName){if(typeof ay.symbolName==="string"){try{av=R[ay.symbolName].indexOffset;if(typeof ay.symbolNameArrIdx==="number"){av+=R[ay.symbolName].itemSize*(ay.symbolNameArrIdx-R[ay.symbolName].arrStartIdx)}if(typeof ay.addrOffset==="number"){av+=ay.addrOffset}if(typeof ay.offs==="string"){av+=parseInt(ay.offs,10)/8}else{if(typeof ay.offs==="number"){av+=ay.offs/8}}if(ay.dataTypeNames.length>0){ar=ay.dataTypeNames;aA=R[ay.symbolName].dataType;for(au=0;au<ar.length;au++){aB=aq[aA].subItems[ar[au]];av+=aB.bitOffset/8;if(typeof ay.dataTypeArrIdx[au]==="number"){av+=aB.itemSize*(ay.dataTypeArrIdx[au]-aB.arrStartIdx)}aA=aq[aA].subItems[ar[au]].dataType}}}catch(aw){j("TAME library error: Can't get the IndexOffset for this request!");j("TAME library error: Please check the variable definition (name/offs/subitem).");j(aw);j(ay);return}}else{j("TAME library error: Varible name should be a string!");j(ay);return}}else{j("TAME library error: Neither a name nor an address for the variable/request defined!");j(ay);return}}}if(isNaN(av)){j("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");j("IndexOffset: "+av);j(ay)}return av}function am(aA){var ar={},az,au;if(typeof aA.name==="string"){aA.name=aA.name.toUpperCase();az=aA.name.split(".")}else{return ar}ar.fullSymbolName=aA.name;if(az[0]===""){ar.symbolName="."+az[1]}else{ar.symbolName=az[0]+"."+az[1]}if(ar.symbolName.charAt(ar.symbolName.length-1)==="]"){au=ar.symbolName.substring(0,ar.symbolName.length-1).split("[");ar.symbolName=au[0];ar.symbolNameArrIdx=parseInt(au[1],10)}ar.dataTypeNames=az.slice(2);var av=[],ax,ay,at;if(ac.symTableReady&&ac.dataTypeTableReady&&ar.dataTypeNames.length>0){ax=ar.dataTypeNames;ay=R[ar.symbolName].dataType;ar.dataTypeArrIdx=[];at=0;do{if(ax[at].charAt(ax[at].length-1)==="]"){au=ax[at].substring(0,ax[at].length-1).split("[");ax[at]=au[0];ar.dataTypeArrIdx[at]=parseInt(au[1],10)}if(aq[ay].subItems[ax[at]].pointer===true){j("TAME library error: PLC variable "+[ax[at]]+" is a pointer! Can't get the variable value.")}if(at===ax.length-1){break}ay=aq[ay].subItems[ax[at]].dataType;at++}while(at<ax.length);try{if(aA.type===undefined){ar.type=aq[ay].subItems[ax[at]].type}ar.arrayLength=aq[ay].subItems[ax[at]].arrayLength;ar.arrayDataType=aq[ay].subItems[ax[at]].arrayDataType;ar.dataType=aq[ay].subItems[ax[at]].dataType;ar.itemSize=aq[ay].subItems[ax[at]].itemSize;if(ar.size===undefined){ar.size=aq[ay].subItems[ax[at]].size}ar.bitOffset=aq[ay].subItems[ax[at]].bitOffset;ar.offs=aA.offs;if(ar.type==="STRING"||ar.arrayDataType==="STRING"){ar.stringLength=aq[ay].subItems[ax[at]].stringLength;ar.format=ar.stringLength}else{if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(ar.dataTypeArrIdx[at]!==undefined&&ar.type==="ARRAY"){ar.type=aq[ay].subItems[ax[at]].arrayDataType;ar.size=aq[ay].subItems[ax[at]].itemSize}}catch(aw){j("TAME library error: A problem occured while reading a data type from the data type table!");j(aw);j(aA)}}else{if(ac.symTableReady){if(typeof R[aA.name]=="object"){try{if(aA.type===undefined){ar.type=R[aA.name].type}ar.arrayLength=R[aA.name].arrayLength;ar.arrayDataType=R[aA.name].arrayDataType;ar.dataType=R[aA.name].dataType;ar.itemSize=R[aA.name].itemSize;if(ar.size===undefined){ar.size=R[aA.name].size}ar.bitOffset=R[aA.name].bitOffset;ar.offs=aA.offs;if(ar.type==="STRING"||ar.arrayDataType==="STRING"){ar.stringLength=R[aA.name].stringLength;ar.format=ar.stringLength}else{if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(ar.symbolNameArrIdx!==undefined&&ar.type==="ARRAY"){ar.type=R[aA.name].arrayDataType;ar.size=R[aA.name].itemSize}}catch(aw){j("TAME library error: A problem occured while reading a data type from the symbol table!");j(aw);j(aA)}}else{if(typeof aA.type!="string"){j("TAME library error: Neither an entry for this symbol in the symbol table nor the type defined by user!");j(aA)}}}}if(typeof aA.type=="string"){av=aA.type.split(".");ar.type=av[0];if(av.length>2){av[1]=av.slice(1).join(".")}if(ar.type==="STRING"){av[1]=parseInt(av[1],10);if(ao(av[1])){ar.format=av[1]}else{ar.format=C.STRING;j("TAME library warning: Length of string variable not defined: "+aA.name);j("TAME library warning: A length of 80 characters (TwinCAT default) will be used.")}ar.stringLength=ar.format;ar.size=ar.format++}else{if(ar.type==="ARRAY"){}else{if(ar.type==="USER"){}else{ar.format=av[1];ar.size=C[ar.type]}}}if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(typeof ar.type!="string"){j("TAME library error: Could not get the type of the item!");j(aA)}return ar}function ab(){var at;if(window.XMLHttpRequest){at=new window.XMLHttpRequest()}else{try{at=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(au){try{at=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(ar){at=null;j("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return at}function u(ar){if(ar.reqDescr===undefined){ar.reqDescr={}}else{if(ar.reqDescr.debug){j(ar)}}ar.send=function(){var at,au;if(typeof this.reqDescr.id==="number"&&F[this.reqDescr.id]>0){j("TAME library warning: Request dropped (last request with ID "+ar.reqDescr.id+" not finished!)");F[this.reqDescr.id]++;if(F[this.reqDescr.id]<=ac.maxDropReq){return}F[this.reqDescr.id]=0}if(ar.sync===true){au=false}else{if(this.reqDescr.sync===true){au=false}else{if(this.reqDescr.sync===false){au=true}else{if(e.syncXmlHttp===true){au=false}else{au=true}}}}this.xmlHttpReq=ab();at="<?xml version='1.0' encoding='utf-8'?>";at+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";at+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";at+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";at+="<soap:Body><q1:";at+=this.method;at+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";at+=e.amsNetId;at+="</netId><nPort xsi:type='xsd:int'>";at+=e.amsPort;at+="</nPort>";if(this.indexGroup!==undefined){at+="<indexGroup xsi:type='xsd:unsignedInt'>";at+=this.indexGroup;at+="</indexGroup>"}if(this.indexOffset!==undefined){at+="<indexOffset xsi:type='xsd:unsignedInt'>";at+=this.indexOffset;at+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){at+="<cbRdLen xsi:type='xsd:int'>";at+=this.reqDescr.readLength;at+="</cbRdLen>"}if(this.pData&&this.pData.length>0){at+="<pData xsi:type='xsd:base64Binary'>";at+=this.pData;at+="</pData>"}if(this.pwrData&&this.pwrData.length>0){at+="<pwrData xsi:type='xsd:base64Binary'>";at+=this.pwrData;at+="</pwrData>"}at+="</q1:";at+=this.method;at+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",e.serviceUrl,au,e.serviceUser,e.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(au===true){this.xmlHttpReq.onreadystatechange=function(){if((ar.xmlHttpReq.readyState===4)&&(ar.xmlHttpReq.status===200)){ac.parseResponse(ar)}};this.xmlHttpReq.send(at)}else{this.xmlHttpReq.send(at);ac.parseResponse(ar)}if(typeof this.reqDescr.id==="number"){F[this.reqDescr.id]=1}}};return ar}function W(av,au,at,ar){var aw;if(typeof av.val==="string"){if(au==="REAL"||au==="LREAL"){aw=parseFloat(av.val)}else{aw=parseInt(av.val,10)}}else{if(typeof av.val==="number"){aw=av.val}else{j("TAME library error: Wrong variable type for a numeric variable in write request!");j("TAME library error: Variable type should be number or string, but is "+typeof av.val);j(av);aw=0}}if(isNaN(aw)){aw=0;j("TAME library error: Value of a numeric variable in write request is not a number.");j(av)}if(ac.useCheckBounds===true){if(au==="LREAL"){if(!isFinite(aw)){j("TAME library warning: Limit for LREAL value exceeded!");j("Upper limit: "+Number.MAX_VALUE);j("Lower limit: "+Number.MIN_VALUE);j("value: "+aw);j(av)}}else{if(au==="REAL"){if(aw>0){if(aw<1.175495e-38){j("TAME library warning: Lower limit for positive REAL value exceeded!");j("limit: 1.175495e-38");j("value: "+aw);j(av);aw=1.175495e-38}else{if(aw>3.402823e+38){j("TAME library warning: Upper limit for positive REAL value exceeded!");j("limit: 3.402823e+38");j("value: "+aw);j(av);aw=3.402823e+38}}}else{if(aw<0){if(aw>-1.175495e-38){j("TAME library warning: Upper limit for negative REAL value exceeded!");j("limit: -1.175495e-38");j("value: "+aw);j(av);aw=-1.175495e-38}else{if(aw<-3.402823e+38){j("TAME library warning: Lower limit for negative REAL value exceeded!");j("limit: -3.402823e+38");j("value: "+aw);j(av);aw=-3.402823e+38}}}}}else{if(aw<at){j("TAME library warning: Lower limit for numeric value exceeded!");j("type: "+au);j("limit: "+at);j("value: "+aw);j(av);aw=at}else{if(aw>ar){j("TAME library warning: Upper limit for numeric value exceeded!");j("type: "+au);j("limit: "+ar);j("value: "+aw);j(av);aw=ar}}}}}return aw}function ak(av){var ar=[],aw,at,au;if(typeof av.type==="string"){ar=av.type.split(".");if(ar.length>2){ar[1]=ar.slice(1).join(".")}}else{j("TAME library error: Could not get the type of the item (function getTypeAndFormat())!");j(av)}return ar}function g(at){var av={},ar,au;au=aq[at].subItems;for(ar in au){if(au[ar].type==="USER"){j("TAME library error: Automatic creating of nested structures is not supported (yet)!");av[ar]=g(au[ar].dataType)}else{if(au.hasOwnProperty(ar)){av[ar]=au[ar].fullType}}}return av}function L(ar){if((ar>=97)&&(ar<=102)){return(ar-87)}if((ar>=65)&&(ar<=70)){return(ar-55)}if((ar>=48)&&(ar<=57)){return(ar-48)}return 0}function ai(aw,at){var ar=[],av=aw.toString(16),au;while(av.length<at*2){av="0"+av}for(au=0;au<at;au++){ar[(at-1)-au]=((L(av.charCodeAt(au*2))*16)+L(av.charCodeAt((au*2)+1)))}return ar}function q(at){var aw=0,az=0,ax,ar,av,ay,au;ar=Math.abs(at);if(at!==0){for(au=128;au>-127;au--){av=ar/Math.pow(2,au);if(av>=2){break}ay=au;ax=av}ay+=127;ax=ax.toString(2);for(au=2;au<25;au++){aw<<=1;if(ax.charAt(au)==="1"){aw+=1}}if(ax.charAt(25)==="1"){aw+=1}az=ay;az<<=23;az+=aw;if(at<0){az+=2147483648}}return az}function E(ay){var au=0,aA=0,av={part1:0,part2:0},aB,ax,at,ar,az,aw;aB=Math.abs(ay);if(ay!==0){for(aw=1024;aw>=-1023;aw--){ax=aB/Math.pow(2,aw);if(ax>=2){break}at=aw;az=ax}at+=1023;az=az.toString(2);for(aw=2;aw<22;aw++){au<<=1;if(az.charAt(aw)==="1"){au+=1}}if(az.charAt(aw)==="1"){ar=true}aw++;for(aw;aw<54;aw++){aA<<=1;if(az.charAt(aw)==="1"){aA+=1}}av.part1=at;av.part1<<=20;av.part1+=au;if(ay<0){av.part1+=2147483648}av.part2=aA;if(ar===true){av.part2+=2147483648}}return av}function M(au,at){var ar;switch(at){case"#d":case"#dd":ar=au*86400000;break;case"#h":case"#hh":ar=au*3600000;break;case"#m":case"#mm":ar=au*60000;break;case"#s":case"#ss":ar=au*1000;break;case"#ms":case"#msmsms":ar=au;break;default:ar=au;break}return ar}function D(az,aB){var ar=aB.split("#"),ay=ar.length,aA=/:|\.|-|_/,au=0,at=0,aw,av,ax,aC;for(av=1;av<ay;av++){if(aA.test(ar[av])===true){aC=true}}if(aC!==true){j("TAME library error: No separator ( : . - _ ) for TOD string found!");j("String: "+az);j("Format: "+aB);return 0}ax=az.split(aA);for(av=1;av<ay;av++){switch(ar[av]){case"h":case"hh":aw=parseInt(ax[at],10)*3600000;at++;break;case"m":case"mm":aw=parseInt(ax[at],10)*60000;at++;break;case"s":case"ss":aw=parseInt(ax[at],10)*1000;at++;break;case"ms":case"msmsms":aw=parseInt(ax[at],10);at++;break;default:aw=0}au+=aw}return au}function n(ay){var ax=l,av=0,at="",aw,au,ar;while(av<ay.length){aw=ay[av++];au=ay[av++];ar=ay[av++];at=at+ax[aw>>2]+ax[((aw&3)<<4)|(au>>4)]+(isNaN(au)?"=":ax[(((au&15)<<2)|(ar>>6))])+((isNaN(au)||isNaN(ar))?"=":ax[ar&63])}return at}function d(ay,aw,ax,av){var aA=[],ar,az,at,au;if(ay.val===undefined){switch(aw){case"STRING":ay.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":ay.val=new Date();break;default:ay.val=0;break}j("TAME library warning: Value of a variable in write request is not defined!");j(ay)}switch(aw){case"BOOL":if(ay.val){aA[0]=1}else{aA[0]=0}break;case"BYTE":case"USINT":ar=W(ay,aw,0,255);aA=ai(ar,av);break;case"SINT":ar=W(ay,aw,-128,127);if(ar<0){ar=ar+256}aA=ai(ar,av);break;case"WORD":case"UINT":ar=W(ay,aw,0,65535);aA=ai(ar,av);break;case"INT":case"INT16":ar=W(ay,aw,-32768,32767);if(ar<0){ar=ar+65536}aA=ai(ar,av);break;case"INT1DP":ay.val=Math.round(ay.val*10);ar=W(ay,aw,-32768,32767);if(ar<0){ar=ar+65536}aA=ai(ar,av);break;case"DWORD":case"UDINT":ar=W(ay,aw,0,4294967295);aA=ai(ar,av);break;case"DINT":ar=W(ay,aw,-2147483648,2147483647);if(ar<0){ar=ar+4294967296}aA=ai(ar,av);break;case"REAL":ar=W(ay,aw);ar=q(ar);aA=ai(ar,av);break;case"LREAL":ar=W(ay,aw);ar=E(ar);aA=ai(ar.part2,4);aA=aA.concat(ai(ar.part1,4));break;case"DATE":if(typeof ay.val==="object"){ay.val.setHours(0);ay.val.setMinutes(0);ay.val.setSeconds(0);ar=ay.val.getTime()/1000-ay.val.getTimezoneOffset()*60}else{j("TAME library error: Value of a DATE variable in write request is not a date object!");j(ay)}aA=ai(ar,av);break;case"DT":case"DATE_AND_TIME":if(typeof ay.val==="object"){ar=ay.val.getTime()/1000-ay.val.getTimezoneOffset()*60}else{j("TAME library error: Value of a DT variable in write request is not a date object!");j(ay)}aA=ai(ar,av);break;case"TOD":case"TIME_OF_DAY":if(typeof ay.val==="object"){ay.val.setYear(1970);ay.val.setMonth(0);ay.val.setDate(1);ar=ay.val.getTime()-ay.val.getTimezoneOffset()*60000}else{if(typeof ay.val==="string"){if(ax===""||ax===undefined){ax="#hh#:#mm";j("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");j(ay)}ar=D(ay.val,ax)}else{j("TAME library error: TOD value in write request is wether a date object nor a string!");j(ay)}}aA=ai(ar,av);break;case"STRING":az=(ax===undefined)?C.STRING:parseInt(ax,10);if(ao(az)){at=az<ay.val.length?az:ay.val.length;for(au=0;au<at;au++){aA[au]=ay.val.charCodeAt(au)}for(au;au<az;au++){aA[au]=0}aA[au]=0}break;case"TIME":ar=parseInt(ay.val,10);if(isNaN(ar)){j("TAME library warning: Value of a TIME variable in write request is not defined!");j(ay);ar=0}ar=M(ar,ax);if(ar<0){ar=0;j("TAME library warning: Lower limit for TIME variable in write request exceeded!)");j("value: "+ay.val+ax);j(ay)}else{if(ar>4294967295){ar=4294967295;j("TAME library warning: Upper limit for TIME variable in write request exceeded!)");j("value: "+ay.val+ax);j(ay)}}aA=ai(ar,av);break;case"EndStruct":break;default:j("TAME library error: Unknown data type in write request : "+aw);break}return aA}function s(at){var ar=at.toString(16);if((ar.length%2)!==0){ar="0"+ar}return ar}function h(at,ar){ar=(isNaN(ar))?0:ar;var au=at.toString(10);while(au.length<ar){au="0"+au}return au}function ap(ay,ax){var ar=ax.split("#"),aw=ar.length,at="",av,au;for(au=1;au<aw;au++){switch(ar[au]){case"D":av=ay.getDate();break;case"DD":av=ay.getDate();av=h(av,2);break;case"WD":av=ay.getDay();break;case"WKD":av=ac.dateNames.weekdShort[ay.getDay()];break;case"WEEKDAY":av=ac.dateNames.weekdLong[ay.getDay()];break;case"M":av=ay.getMonth()+1;break;case"MM":av=ay.getMonth()+1;av=h(av,2);break;case"MON":av=ac.dateNames.monthsShort[ay.getMonth()];break;case"MONTH":av=ac.dateNames.monthsLong[ay.getMonth()];break;case"YY":av=ay.getYear();while(av>100){av-=100}break;case"YYYY":av=ay.getFullYear();break;case"h":av=ay.getHours();break;case"hh":av=ay.getHours();av=h(av,2);break;case"m":av=ay.getMinutes();break;case"mm":av=ay.getMinutes();av=h(av,2);break;case"s":av=ay.getSeconds();break;case"ss":av=ay.getSeconds();av=h(av,2);break;case"ms":av=ay.getMilliseconds();break;case"msmsms":av=ay.getMilliseconds();av=h(av,3);break;default:av=ar[au];break}at=at+av}return at}function K(ay,ax){var ar=ax.split("#"),aw=ar.length,at="",av,au;for(au=1;au<aw;au++){switch(ar[au]){case"d":if(aw<=2){av=ay/86400000}else{av=Math.floor(ay/86400000);ay=ay%86400000}break;case"dd":if(aw<=2){av=ay/86400000}else{av=Math.floor(ay/86400000);ay=ay%86400000}av=h(av,2);break;case"h":if(aw<=2){av=ay/3600000}else{av=Math.floor(ay/3600000);ay=ay%3600000}break;case"hh":if(aw<=2){av=ay/3600000}else{av=Math.floor(ay/3600000);ay=ay%3600000}av=h(av,2);break;case"m":if(aw<=2){av=ay/60000}else{av=Math.floor(ay/60000);ay=ay%60000}break;case"mm":if(aw<=2){av=ay/60000}else{av=Math.floor(ay/60000);ay=ay%60000}av=h(av,2);break;case"s":if(aw<=2){av=ay/1000}else{av=Math.floor(ay/1000);ay=ay%1000}break;case"ss":if(aw<=2){av=ay/1000}else{av=Math.floor(ay/1000);ay=ay%1000}av=h(av,2);break;case"ms":av=ay;break;case"msmsms":av=ay;av=h(av,3);break;default:av=ar[au];break}at=at+av}return at}function U(at){var ar=s(at.charCodeAt(0));return parseInt(ar,16)}function aj(ar){var at=U(ar);if(at>127){at=at-256}return at}function Q(at){var ar=s(at.charCodeAt(1));ar+=s(at.charCodeAt(0));return parseInt(ar,16)}function P(ar){var at=Q(ar);if(at>32767){at=at-65536}return at}function H(at){var ar=s(at.charCodeAt(3));ar+=s(at.charCodeAt(2));ar+=s(at.charCodeAt(1));ar+=s(at.charCodeAt(0));return parseInt(ar,16)}function S(ar){var at=H(ar);if(at>2147483647){at=at-4294967296}return at}function aa(ar,au){var at=H(ar);if(au===undefined){return at}return(K(at,au))}function m(ar,au){var at=new Date(H(ar));at=new Date(at.getTime()+at.getTimezoneOffset()*60000);if(au===undefined){return at}return(ap(at,au))}function ah(at,au){var ar=new Date(H(at)*1000);ar=new Date(ar.getTime()+ar.getTimezoneOffset()*60000);if(au===undefined){return ar}return(ap(ar,au))}function p(au){var aw=1,ay=0.5,at=H(au),ar,ax,av;if(at===0){return 0}ar=((at>>>31)===1)?"-":"+";at<<=1;ax=(at>>>24)-127;at<<=8;for(av=1;av<=23;av++){aw+=at<0?ay:0;at<<=1;ay/=2}return parseFloat(ar+(aw*Math.pow(2,ax)))}function G(au){var at=H(au.substring(4,8)),ax=H(au.substring(0,4)),aw=12,av=1,az=0.5,ar,ay;if(at===0&&ax===0){return 0}ar=((at>>>31)===1)?"-":"+";at<<=1;ay=(at>>>21)-1023;at<<=11;while(aw<32){av+=at<0?az:0;at<<=1;az/=2;aw++}if((ax>>>31)===1){av+=az;ax<<=1;az/=2}while(aw<64){av+=ax<0?az:0;ax<<=1;az/=2;aw++}return parseFloat(ar+(av*Math.pow(2,ay)))}function af(ar){return ar.split(String.fromCharCode(0))[0]}function T(av){var aw=o,ay=0,ar="",ax,au,at,aC,aB,aA,az;av=av.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aC=aw[av.charAt(ay++)];aB=aw[av.charAt(ay++)];aA=aw[av.charAt(ay++)];az=aw[av.charAt(ay++)];ax=(aC<<2)|(aB>>4);au=((aB&15)<<4)|(aA>>2);at=((aA&3)<<6)|az;ar+=String.fromCharCode(ax);if(aA!==64){ar+=String.fromCharCode(au)}if(az!==64){ar+=String.fromCharCode(at)}}while(ay<av.length);return ar}function Y(at,ar,av){var au;switch(ar){case"BOOL":au=(at.charCodeAt(0)!="0");break;case"BYTE":case"USINT":au=U(at);break;case"SINT":au=aj(at);break;case"WORD":case"UINT":au=Q(at);break;case"INT":case"INT16":au=P(at);break;case"INT1DP":au=((P(at))/10).toFixed(1);break;case"DWORD":case"UDINT":au=H(at);break;case"DINT":au=S(at);break;case"REAL":au=p(at);if(av!==undefined){au=au.toFixed(parseInt(av,10))}break;case"LREAL":au=G(at);if(av!==undefined){au=au.toFixed(parseInt(av,10))}break;case"STRING":au=af(at);break;case"TOD":case"TIME_OF_DAY":au=m(at,av);break;case"TIME":au=aa(at,av);break;case"DT":case"DATE":case"DATE_AND_TIME":au=ah(at,av);break;case"EndStruct":break;default:j("TAME library error: Unknown data type at parsing read request: "+ar);break}return au}function x(aK){var ar,aC=aK.reqDescr.items,aA=[],aD=0,aH,au,av,aJ,ay,aF,az,aI,at,aE,aB,aw,ax;try{ar=aK.xmlHttpReq.responseXML.documentElement;au=T(ar.getElementsByTagName("ppData")[0].firstChild.data);for(aB=0,aw=aC.length;aB<aw;aB++){aH=aC[aB];aA=ak(aH);at=aA[0];aE=aA[1];aF=C[at];switch(at){case"STRING":if(aE!==undefined){ay=parseInt(aE,10)}aF=(ao(ay)?ay:aF)+1;break;case"EndStruct":aF=aH.val;break}az=aF<a?aF:a;if(aK.reqDescr.seq!==true){ax=i(aK.reqDescr);aD=aH.addr-ax}else{if(aK.reqDescr.calcAlignment===true&&az>1&&at!=="EndStruct"&&at!=="STRING"&&aD>0){aI=aD%az;if(aI>0){aD+=az-aI}}}av=au.substr(aD,aF);aJ=Y(av,at,aE);if(at!=="EndStruct"){B(aH.jvar,aJ,aK.reqDescr.dataObj,aH.prefix,aH.suffix)}if(aK.reqDescr.seq===true){aD+=aF}}}catch(aG){j("TAME library error: Parsing of Read Request failed:"+aG);j(aH);return}}function c(aR){var ar,aF=aR.reqDescr.items,aC=[],aJ=0,au=0,aH=window,aO=0,aN,aw,ax,aQ,aL,av,aK,aD,aA,ay,aG,aI,aB,az,aE;function at(){var aT,aS;if(av==="STRING"){if(aK!==undefined){aT=parseInt(aK,10)}else{if(typeof aE.stringLength==="number"){aT=aE.stringLength}}aL=(ao(aT)?aT:aL)+1}aS=ax.substr(au,aL);aQ=Y(aS,av,aK);B(aG,aQ,aH,aN.prefix,aN.suffix);au+=aL}function aP(){var aU,aT,aY,aX,aV,aW;function aS(){var a0,aZ;if(a>1&&av!=="STRING"&&av!=="EndStruct"){a0=aL<a?aL:a;if(a0>1&&au>0){aZ=au%a0;if(aZ>0){au+=a0-aZ}}if(a0>aO){aO=a0}}}if(typeof aN.def==="string"){aN.def=B(aN.def)}else{if(ac.dataTypeTableReady===true&&aN.def===undefined){aN.def=g(aE.dataType)}else{if(typeof aN.def!=="object"){j("TAME library error: No structure defininition found (parseSumReadReq())!");j(aN)}}}for(aW in aN.def){if(aN.def.hasOwnProperty(aW)){aT=aN.def[aW].split(".");if(aT[0]==="ARRAY"){aY=parseInt(aT[1],10);aX=aT.length-1;for(aU=0;aU<aY;aU++){av=aT[2];if(aT[aX]==="SP"){aG=aW+aU;if(aX>=4){aK=aT.slice(3,-1).join(".")}}else{aG=aW+"."+aU;if(aX>=3){aK=aT.slice(3).join(".")}}if(aI!==null){aG=aI+"."+aG}aL=C[av];aS();at()}}else{if(aI!==null){aG=aI+"."+aW}else{aG=aW}av=aT[0];if(aT.length>2){aT[1]=aT.slice(1).join(".")}aK=aT[1];aL=C[av];aS();at()}}}if(a>1&&aO>1&&av!=="STRING"&&av!=="EndStruct"){if(aO>a){aO=a}aV=au%aO;if(aV>0){au+=aO-aV}}}try{ar=aR.xmlHttpReq.responseXML.documentElement;aw=T(ar.getElementsByTagName("ppRdData")[0].firstChild.data);for(aD=0,aA=aF.length;aD<aA;aD++){ax=aw.substr(aJ,4);ay=Y(ax,"DWORD");if(ay!==0){j("TAME library error: ADS sub command error while processing a SumReadRequest!");j("Error code: "+ay);j(aF[aD])}aJ+=4}for(aD=0;aD<aA;aD++){aN=aF[aD];aE=am(aN);av=aE.type;aK=aE.format;az=aE.size;aI=null;ax=aw.substr(aJ,az);switch(av){case"ARRAY":aH=B(aN.jvar);au=0;aB=aE.arrayLength;if(aE.arrayDataType==="USER"){for(aI=0;aI<aB;aI++){aP()}}else{av=aE.arrayDataType;aL=C[av];for(aI=0;aI<aB;aI++){aG=aI;at()}}break;case"USER":aH=B(aN.jvar);au=0;aP();break;default:aH=window;aQ=Y(ax,av,aK);B(aN.jvar,aQ,aH,aN.prefix,aN.suffix)}aJ+=az}}catch(aM){j("TAME library error: Parsing of SumReadRequest failed:"+aM);j(aN);return}}function y(aM){var ar,aD=aM.reqDescr.items,aB=[],az=[],aF=0,at=0,aE=window,aJ,av,aw,aL,aH,au,aG,aC,ay,ax,aA,aK;try{ar=aM.xmlHttpReq.responseXML.documentElement;av=T(ar.getElementsByTagName("ppRdData")[0].firstChild.data);for(aC=0,ay=aD.length;aC<ay;aC++){aw=av.substr(aF,4);ax=Y(aw,"DWORD");if(ax===0){if(aM.reqDescr.isRelHdlReq===true){aK=aD[aC].toUpperCase();delete O[aK];aA=r.indexOf(aK);delete r[aA];az[aC]=aK}}else{j("TAME library error: ADS sub command error while processing a SumReadRequest!");j("Error code: "+ax);j(aD[aC])}aF+=4}if(aM.reqDescr.isRelHdlReq===true){for(aC=r.length-1;aC>=0;aC--){if(r[aC]===undefined){r.splice(aC,1)}}if(r.length===0){ac.handleCacheReady=false;j("TAME library info: All handles released.")}else{j("TAME library info: Released handles:");j(az)}}}catch(aI){j("TAME library error: Parsing of SumWriteRequest failed:"+aI);j(aJ);return}}function al(au){var ar;try{ar=au.xmlHttpReq.responseXML.documentElement;ac.adsState=parseInt(ar.getElementsByTagName("pAdsState")[0].firstChild.data,10);ac.adsStateTxt=V[ac.adsState];ac.deviceState=parseInt(ar.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(at){j("TAME library error: Parsing of ADS Read State Request failed:"+at);return}}function X(aC){var av,aw=r,at=0,ar=0,ax,au,ay,aB,az,aA,aD;av=aC.xmlHttpReq.responseXML.documentElement;ax=T(av.getElementsByTagName("ppRdData")[0].firstChild.data);for(aB=0,az=aw.length;aB<az;aB++){au=ax.substr(at,4);aA=Y(au,"DWORD");at+=4;au=ax.substr(at,4);aD=Y(au,"DWORD");at+=4;if(aA!==0){j("TAME library error: Error while reading a handle from the PLC!");j("Error code: "+aA);j("Handle: "+aw[aB]);throw"Handle request aborted!"}}for(aB=0;aB<az;aB++){au=ax.substr(at,4);ay=Y(au,"DWORD");at+=4;O[aw[aB]]=ay}ac.handleCacheReady=true;j("TAME library info: Handle cache ready.")}function N(ay,ax,av){var au={},aw,ar,at;av.type=ax;at=am(av);ar=C[ax];switch(ax){case"STRING":if(ao(av.strlen)){ax+="."+av.strlen;ar=av.strlen}else{if(typeof at.stringLength==="number"){ar=at.stringLength;ax+="."+ar}else{j("TAME library error: Could not get the length of the string for this request!");j(av)}}ar++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof av.format==="string"){ax+="."+av.format}break;case"REAL":case"LREAL":if(typeof av.decPlaces==="number"){ax+="."+av.decPlaces}else{if(typeof av.dp==="number"){ax+="."+av.dp}}break}au={addr:av.addr,symbolName:at.symbolName,dataTypeNames:at.dataTypeNames,dataTypeArrIdx:at.dataTypeArrIdx,symbolNameArrIdx:at.symbolNameArrIdx,fullSymbolName:av.name,useHandle:av.handle,id:av.id,oc:av.oc,ocd:av.ocd,readLength:ar,debug:av.debug,sync:av.sync,offs:av.offs,seq:true,items:[{val:av.val,jvar:av.jvar,type:ax,prefix:av.prefix,suffix:av.suffix}]};if(ay==="Write"){ac.writeReq(au)}else{ac.readReq(au)}}function I(av,aw,au){var ax={},aJ={},aD,at,aL=0,aM=0,aK=0,aN,ar=[],aP,az,aC=0,aE,aA,aO=0,aF=0,aR,aB,aQ,aH,aG;aG=am(au);if(av==="Write"&&typeof au.val==="object"){aJ=au.val}else{if(typeof au.jvar==="string"){aJ=B(au.jvar)}else{j("TAME library error: No data object for this "+av+"-Request defined!")}}if(typeof au.arrlen==="number"){aD=au.arrlen}else{if(aG.arrayLength!==undefined){aD=aG.arrayLength}else{j("TAME library error: Can't get the array length for this request!");j(au)}}if(typeof au.item==="number"&&!isNaN(au.item)&&av==="Write"){aQ=true;if(au.item<0||au.item>aD-1){j('TAME library error: Wrong value for "item"!');j("item: "+au.item);j("Last array index: "+(aD-1))}}function ay(){var aS;if(typeof au.def==="string"){au.def=B(au.def)}else{if(ac.dataTypeTableReady===true&&au.def===undefined){au.def=g(aG.dataType)}else{if(typeof au.def!=="object"){j("TAME library error: No structure definition found!")}}}for(aS in au.def){if(au.def.hasOwnProperty(aS)){ar=au.def[aS].split(".");if(ar[0]==="ARRAY"){aP=parseInt(ar[1],10);ar.shift();ar.shift()}else{aP=1}for(aM=0;aM<aP;aM++){if(ar[0]==="STRING"){if(typeof ar[1]==="string"){aE=parseInt(ar[1],10)}aA=(ao(aE)?aE:C[ar[0]])+1}else{aA=C[ar[0]]}if(a>1&&aA>1&&ar[0]!=="STRING"&&aC>0){aR=aC%aA;if(aR>0){aC+=aA-aR}}aC+=aA}if(a>1&&aA>aO&&ar[0]!=="STRING"){aO=aA}}}if(a>1&&aO>1&&ar[0]!=="STRING"){if(aO>a){aO=a}aR=aC%aO;if(aR>0){aF=aO-aR;aC+=aF}}if(aQ){at=aC*au.item;aD=1}ax={addr:au.addr,symbolName:aG.symbolName,dataTypeNames:aG.dataTypeNames,fullSymbolName:au.name,addrOffset:at,useHandle:au.handle,id:au.id,oc:au.oc,ocd:au.ocd,debug:au.debug,readLength:aC*aD,seq:true,calcAlignment:true,dataObj:aJ,sync:au.sync,offs:au.offs,items:[]};for(aM=0;aM<aD;aM++){for(aS in au.def){if(au.def.hasOwnProperty(aS)){ar=au.def[aS].split(".");if(ar[0]==="ARRAY"){aP=parseInt(ar[1],10);az=ar.length-1;for(aK=0;aK<aP;aK++){if(ar[az]==="SP"){ax.items[aL]={jvar:aM+"."+aS+aK};if(az===4){ax.items[aL].type=ar[2]+"."+ar[3]}else{ax.items[aL].type=ar[2]}}else{ax.items[aL]={jvar:aM+"."+aS+"."+aK};if(az===3){ax.items[aL].type=ar[2]+"."+ar[3]}else{ax.items[aL].type=ar[2]}}if(av==="Write"){if(aQ){if(ar[az]==="SP"){ax.items[aL].val=aJ[au.item][aS+aK]}else{ax.items[aL].val=aJ[au.item][aS][aK]}}else{if(ar[az]==="SP"){ax.items[aL].val=aJ[aM][aS+aK]}else{ax.items[aL].val=aJ[aM][aS][aK]}}}aL++}}else{ax.items[aL]={jvar:aM+"."+aS,type:au.def[aS]};if(av==="Write"){if(aQ){ax.items[aL].val=aJ[au.item][aS]}else{ax.items[aL].val=aJ[aM][aS]}}aL++}}}if(a>1){ax.items[aL]={type:"EndStruct",val:aF};aL++}}}function aI(){aN=C[aw];switch(aw){case"STRING":if(ao(au.strlen)){aw+="."+au.strlen;aN=au.strlen}else{if(typeof aG.stringLength==="number"){aN=aG.stringLength;aw+="."+aN}else{j("TAME library error: Could not get the length of the string for this request!");j(au)}}aN++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof au.format==="string"){aw+="."+au.format}break;case"REAL":case"LREAL":if(typeof au.decPlaces==="number"){aw+="."+au.decPlaces}else{if(typeof au.dp==="number"){aw+="."+au.dp}}break}if(aQ){at=au.item*aN;aD=1}ax={addr:au.addr,symbolName:aG.symbolName,dataTypeNames:aG.dataTypeNames,dataTypeArrIdx:aG.dataTypeArrIdx,symbolNameArrIdx:aG.symbolNameArrIdx,fullSymbolName:au.name,useHandle:au.handle,addrOffset:at,id:au.id,oc:au.oc,ocd:au.ocd,readLength:aN*aD,debug:au.debug,seq:true,dataObj:aJ,items:[]};for(aM=0;aM<aD;aM++){ax.items[aM]={jvar:aM,type:aw};if(av==="Write"){if(aQ){ax.items[aM].val=aJ[au.item]}else{ax.items[aM].val=aJ[aM]}}}}if(aw==="STRUCT"){ay()}else{aI()}if(av==="Write"){ac.writeReq(ax)}else{ac.readReq(ax)}}function ae(ar,aB){var ay={},at={},aC=[],aw=0,aA,av,ax,az,au;au=am(aB);if(ar==="Write"&&typeof aB.val==="object"){at=aB.val}else{if(typeof aB.jvar==="string"){at=B(aB.jvar)}else{j("TAME library error: No data object for this "+ar+"-Request defined!")}}if(typeof aB.def==="string"){aB.def=B(aB.def)}else{if(ac.dataTypeTableReady===true&&aB.def===undefined){aB.def=g(au.dataType)}else{if(typeof aB.def!=="object"){j("TAME library error: No structure defininition found (createArrayDescriptor())!");j(aB)}}}ay={addr:aB.addr,symbolName:au.symbolName,dataTypeNames:au.dataTypeNames,dataTypeArrIdx:au.dataTypeArrIdx,symbolNameArrIdx:au.symbolNameArrIdx,fullSymbolName:aB.name,useHandle:aB.handle,id:aB.id,oc:aB.oc,ocd:aB.ocd,debug:aB.debug,seq:true,calcAlignment:true,dataObj:at,sync:aB.sync,offs:aB.offs,items:[]};for(ax in aB.def){if(aB.def.hasOwnProperty(ax)){aC=aB.def[ax].split(".");if(aC[0]==="ARRAY"){av=parseInt(aC[1],10);aA=aC.length-1;for(az=0;az<av;az++){if(aC[aA]==="SP"){ay.items[aw]={jvar:ax+az};if(aA===4){ay.items[aw].type=aC[2]+"."+aC[3]}else{ay.items[aw].type=aC[2]}}else{ay.items[aw]={jvar:ax+"."+az};if(aA===3){ay.items[aw].type=aC[2]+"."+aC[3]}else{ay.items[aw].type=aC[2]}}if(ar==="Write"){if(aC[aA]==="SP"){ay.items[aw].val=at[ax+az]}else{ay.items[aw].val=at[ax][az]}}aw++}}else{ay.items[aw]={jvar:ax,type:aB.def[ax]};if(ar==="Write"){ay.items[aw].val=at[ax]}aw++}}}if(ar==="Write"){ac.writeReq(ay)}else{ac.readReq(ay)}}this.writeReq=function(av){var ax=av.items,aE={},ar=[],aA=[],aH=[],az,aD,au,ay,at,aF,aB,aG,aw,aC;if(typeof av.name==="string"){av.name=av.name.toUpperCase()}for(aC=0,au=ax.length;aC<au;aC++){aG=ax[aC];aA=ak(aG);az=aA[0];aD=aA[1];if(isNaN(C[az])){j("TAME library error: Could not get the length of the data type: "+az);j("TAME library error: Probably wrong type definition. Please check the manual.");j(av);return}ay=(C[az]<a)?C[az]:a;if(av.calcAlignment===true&&ay>1&&az!=="STRING"&&az!=="EndStruct"&&ar.length>0){aB=ar.length%ay;if(aB>0){aF=ay-aB;for(aw=1;aw<=aF;aw++){ar.push(0)}}}if(az==="EndStruct"){for(aw=1;aw<=aG.val;aw++){ar.push(0)}}else{aH=d(aG,az,aD,C[az]);ar=ar.concat(aH)}}if(ar&&ar.length>0){ar=n(ar)}aE={method:"Write",indexGroup:z(av),indexOffset:i(av),pData:ar,reqDescr:av};u(aE).send()};this.readReq=function(au){var aC={},av=au.items,ax=[],aD,aB,aw,ar,ay,az,aE,aA,at;if(typeof au.readLength!=="number"){au.readLength=0;for(aA=0,ar=av.length;aA<ar;aA++){aD=av[aA];ax=ak(aD);aw=ax[0];aB=ax[1];if(isNaN(C[aw])){j("TAME library error: Could not get the length of the data type: "+aw);j("TAME library error: Probably wrong type definition. Please check the manual.");j(au);return}if(aw==="STRING"){if(typeof aB==="string"){aE=parseInt(aB,10)}az=(ao(aE)?aE:C[aw])+1}else{az=C[aw]}if(au.seq===true){if(au.calcAlignment===true&&az>1&&aw!=="EndStruct"&&aw!=="STRING"&&au.readLength>0){ay=au.readLength%az;if(ay>0){au.readLength+=az-ay}}au.readLength+=az}else{at=i(au);au.readLength=az+aD.addr-at}}}aC={method:"Read",indexGroup:z(au),indexOffset:i(au),reqDescr:au};u(aC).send()};this.sumReadReq=function(av){var aD={},ax=av.items,aA=[],aF=[],aG=[],au=ax.length,aw={},az,aC,aE,aB,ay,ar,at;av.readLength=au*4;for(aB=0;aB<au;aB++){aE=ax[aB];at=am(aE);ay=at.size;av.readLength+=ay;aw.val=z(at);aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG);aw.val=i(at);aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG);aw.val=ay;aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG)}if(aF.length>0){ar=n(aF)}aD={method:"ReadWrite",indexGroup:k.SumRd,indexOffset:ax.length,pwrData:ar,reqDescr:av};u(aD).send()};this.sumWriteReq=function(av){var aO={},aC=av.items,ay=[],at=[],aA=[],aw=aC.length,aL={},aJ=0,au,aG,aI,az,aH,aN,aF,aE,ax,aK,ar,aB;function aD(){var aP;aH=C[au];if(au==="STRING"){if(aG!==undefined){aP=parseInt(aG,10)}else{if(typeof aB.stringLength==="number"){aP=aB.stringLength}}aG=(ao(aP)?aP:aH)}}function aM(){var aS,aX,aP,aT,aV,aQ,aR=[];function aW(){var aZ,aY;if(a>1&&au!=="STRING"&&au!=="EndStruct"){aZ=aH<a?aH:a;if(aZ>1&&aR.length>0){aV=aR.length%aZ;if(aV>0){ar=aZ-aV;for(aY=1;aY<=ar;aY++){aR.push(0)}}}if(aZ>aJ){aJ=aZ}}}if(typeof aI.def==="string"){aI.def=B(aI.def)}else{if(ac.dataTypeTableReady===true&&aI.def===undefined){aI.def=g(aB.dataType)}else{if(typeof aI.def!=="object"){j("TAME library error: No structure defininition found (sumWriteReq())!");j(aI)}}}for(aQ in aI.def){if(aI.def.hasOwnProperty(aQ)){try{aX=aI.def[aQ].split(".");if(aX[0]==="ARRAY"){aP=parseInt(aX[1],10);aT=aX.length-1;for(aS=0;aS<aP;aS++){au=aX[2];if(aX[aT]==="SP"){if(aT>=4){aG=aX.slice(3,-1).join(".")}}else{if(aT>=3){aG=aX.slice(3).join(".")}}if(aF!==null){if(aX[aT]==="SP"){aL.val=aI.val[aF][aQ+aS]}else{aL.val=aI.val[aF][aQ][aS]}}else{aL.val=aI.val[aQ][aS]}aD();aW();aA=d(aL,au,aG,aH);aR=aR.concat(aA)}}else{if(aF!==null){aL.val=aI.val[aF][aQ]}else{aL.val=aI.val[aQ]}au=aX[0];if(aX.length>2){aX[1]=aX.slice(1).join(".")}aG=aX[1];aD();aW();aA=d(aL,au,aG,aH);aR=aR.concat(aA)}}catch(aU){j("TAME library error: Could not set values for a structure in SumWriteReq: "+aU);j(aI)}}}if(a>1&&aJ>1&&aX[0]!=="STRING"&&aX[0]!=="EndStruct"){aV=aR.length%aJ;if(aV>0){ar=aJ-aV;for(aE=1;aE<=ar;aE++){aR.push(0)}}}at=at.concat(aR)}av.readLength=aw*4;for(az=0;az<aw;az++){aI=aC[az];aB=am(aI);au=aB.type;aG=aB.format;aH=aB.size;aL.val=z(aB);aA=d(aL,"UDINT",aG,4);at=at.concat(aA);aL.val=i(aB);aA=d(aL,"UDINT",aG,4);at=at.concat(aA);aL.val=aH;aA=d(aL,"UDINT",aG,4);at=at.concat(aA)}for(az=0;az<aw;az++){aI=aC[az];aB=am(aI);au=aB.type;aG=aB.format;aH=aB.size;aF=null;switch(au){case"ARRAY":ax=parseInt(aB.arrayLength,10);if(ax!==aI.val.length){j("TAME library error: Array length in JS differs from the length in the PLC!");j("Length in JS: "+aI.val.length);j("Length in PLC: "+ax);j(aI);return}if(aB.arrayDataType==="USER"){for(aF=0;aF<ax;aF++){aM()}}else{au=aB.arrayDataType;if(au==="STRING"){aG=aB.stringLength}else{aH=aB.itemSize}for(aF=0;aF<ax;aF++){aL.val=aI.val[aF];aA=d(aL,au,aG,aH);at=at.concat(aA)}}break;case"USER":aM();break;default:if(au==="STRING"){aG=aB.stringLength}else{aH=aB.size}aA=d(aI,au,aG,aH);at=at.concat(aA)}}if(at.length>0){aN=n(at)}aO={method:"ReadWrite",indexGroup:k.SumWr,indexOffset:aC.length,pwrData:aN,reqDescr:av};u(aO).send()};this.readAdsState=function(ar){var at={method:"ReadState",reqDescr:ar};u(at).send()};this.logHandleCache=function(){j(O)};this.logSymbols=function(){j(R)};this.logDataTypes=function(){j(aq)};this.getSymbolsAsJSON=function(){var at;if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{at=JSON.stringify(R);return at}catch(ar){j("TAME library error: Could not convert the Symbol Table to JSON:"+ar)}}};this.setSymbolsFromJSON=function(at){if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{R=JSON.parse(at)}catch(ar){j("TAME library error: Could not create the Symbol Table from JSON:"+ar);return}ac.symTableReady=true;j("TAME library info: Symbol Table successfully created from JSON data.")}};this.getDataTypesAsJSON=function(){var at;if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{at=JSON.stringify(aq);return at}catch(ar){j("TAME library error: Could not convert the Data Type Table to JSON:"+ar)}}};this.setDataTypesFromJSON=function(at){if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{aq=JSON.parse(at)}catch(ar){j("TAME library error: Could not create the Data Type Table from JSON:"+ar);return}ac.dataTypeTableReady=true;j("TAME library info: Data Type Table successfully created from JSON data.")}};this.parseResponse=function(ax){var at,aw,ar;if(typeof ax.reqDescr.id==="number"){F[ax.reqDescr.id]=0}if(ax.xmlHttpReq.responseXML===null){j('TAME library error: Request contains no XML data. Object "responseXML" is null.');j('TAME library error: This is the "responseText":');j(ax.xmlHttpReq.responseText)}try{at=ax.xmlHttpReq.responseXML.documentElement}catch(av){j("TAME library error: No XML data in server response:"+av);return}try{ar=at.getElementsByTagName("faultstring")[0].firstChild.data;try{aw=at.getElementsByTagName("errorcode")[0].firstChild.data}catch(av){aw="-"}j("TAME library error: Message from server:  "+ar+" ("+aw+")");return}catch(au){aw=0}if(typeof at.normalize==="function"){at.normalize()}if(ax.method==="ReadState"){al(ax)}else{if(ax.method==="Read"||ax.method==="ReadWrite"){switch(ax.indexGroup){case k.UploadInfo:Z(ax);break;case k.Upload:ag(ax);break;case k.SumRd:c(ax);break;case k.SumWr:y(ax);break;case k.SumRdWr:X(ax);break;default:x(ax)}}}if(typeof ax.reqDescr.oc==="function"){if(typeof ax.reqDescr.ocd==="number"){window.setTimeout(ax.reqDescr.oc,ax.reqDescr.ocd)}else{ax.reqDescr.oc()}}};this.getHandles=function(au){var aA={},aB=[],ax=au.symbols.length,aC,az,aw,ar,ay,at,av;j("TAME library info: Fetching handles from the PLC.");au.readLength=ax*12;for(az=0;az<ax;az++){aC=ai(k.HandleByName,4);aB=aB.concat(aC);aC=ai(0,4);aB=aB.concat(aC);aC=ai(4,4);aB=aB.concat(aC);aC=ai(au.symbols[az].length,4);aB=aB.concat(aC)}for(az=0;az<ax;az++){at=au.symbols[az].toUpperCase();r[az]=at;aC=[];for(av=0;av<at.length;av++){aC[av]=at.charCodeAt(av)}aB=aB.concat(aC)}if(aB.length>0){ar=n(aB)}aA={method:"ReadWrite",indexGroup:k.SumRdWr,indexOffset:ax,pwrData:ar,reqDescr:au};u(aA).send()};this.releaseHandles=function(at){var ay={},az=[],aA=[],av=0,aw=[],au=0,ax,ar;j("TAME library info: Releasing handles.");if(at===undefined){at={}}if(at.symbols!==undefined){av=at.symbols.length;for(ax=0;ax<av;ax++){aw[ax]=at.symbols[ax].toUpperCase()}}else{av=r.length;aw=r}at.readLength=av*4;for(ax=0;ax<av;ax++){aA=ai(k.ReleaseHandle,4);az=az.concat(aA);aA=ai(0,4);az=az.concat(aA);aA=ai(4,4);az=az.concat(aA)}for(ax=0;ax<av;ax++){if(typeof O[aw[ax]]==="number"){aA=ai(O[aw[ax]],4);az=az.concat(aA)}else{j("TAME library error: Handle for symbol name "+aw[ax]+" does not exist in handle cache!");throw"Releasing Handles aborted!"}}if(az.length>0){ar=n(az)}at.items=aw;at.isRelHdlReq=true;ay={method:"ReadWrite",indexGroup:k.SumWr,indexOffset:av,pwrData:ar,reqDescr:at};u(ay).send()};this.writeBool=function(ar){N("Write","BOOL",ar)};this.writeByte=function(ar){N("Write","BYTE",ar)};this.writeUsint=function(ar){N("Write","USINT",ar)};this.writeSint=function(ar){N("Write","SINT",ar)};this.writeWord=function(ar){N("Write","WORD",ar)};this.writeUint=function(ar){N("Write","UINT",ar)};this.writeInt=function(ar){N("Write","INT",ar)};this.writeInt1Dp=function(ar){N("Write","INT1DP",ar)};this.writeDword=function(ar){N("Write","DWORD",ar)};this.writeUdint=function(ar){N("Write","UDINT",ar)};this.writeDint=function(ar){N("Write","DINT",ar)};this.writeReal=function(ar){N("Write","REAL",ar)};this.writeLreal=function(ar){N("Write","LREAL",ar)};this.writeString=function(ar){N("Write","STRING",ar)};this.writeTime=function(ar){N("Write","TIME",ar)};this.writeTod=function(ar){N("Write","TOD",ar)};this.writeDate=function(ar){N("Write","DATE",ar)};this.writeDt=function(ar){N("Write","DT",ar)};this.readBool=function(ar){N("Read","BOOL",ar)};this.readByte=function(ar){N("Read","BYTE",ar)};this.readUsint=function(ar){N("Read","USINT",ar)};this.readSint=function(ar){N("Read","SINT",ar)};this.readWord=function(ar){N("Read","WORD",ar)};this.readUint=function(ar){N("Read","UINT",ar)};this.readInt=function(ar){N("Read","INT",ar)};this.readInt1Dp=function(ar){N("Read","INT1DP",ar)};this.readDword=function(ar){N("Read","DWORD",ar)};this.readUdint=function(ar){N("Read","UDINT",ar)};this.readDint=function(ar){N("Read","DINT",ar)};this.readReal=function(ar){N("Read","REAL",ar)};this.readLreal=function(ar){N("Read","LREAL",ar)};this.readString=function(ar){N("Read","STRING",ar)};this.readTime=function(ar){N("Read","TIME",ar)};this.readTod=function(ar){N("Read","TOD",ar)};this.readDate=function(ar){N("Read","DATE",ar)};this.readDt=function(ar){N("Read","DT",ar)};this.writeStruct=function(ar){ae("Write",ar)};this.readStruct=function(ar){ae("Read",ar)};this.writeArrayOfBool=function(ar){I("Write","BOOL",ar)};this.writeArrayOfByte=function(ar){I("Write","BYTE",ar)};this.writeArrayOfUsint=function(ar){I("Write","USINT",ar)};this.writeArrayOfSint=function(ar){I("Write","SINT",ar)};this.writeArrayOfWord=function(ar){I("Write","WORD",ar)};this.writeArrayOfUint=function(ar){I("Write","UINT",ar)};this.writeArrayOfInt=function(ar){I("Write","INT",ar)};this.writeArrayOfInt1Dp=function(ar){I("Write","INT1DP",ar)};this.writeArrayOfDword=function(ar){I("Write","DWORD",ar)};this.writeArrayOfUdint=function(ar){I("Write","UDINT",ar)};this.writeArrayOfDint=function(ar){I("Write","DINT",ar)};this.writeArrayOfReal=function(ar){I("Write","REAL",ar)};this.writeArrayOfLreal=function(ar){I("Write","LREAL",ar)};this.writeArrayOfString=function(ar){I("Write","STRING",ar)};this.writeArrayOfTime=function(ar){I("Write","TIME",ar)};this.writeArrayOfTod=function(ar){I("Write","TOD",ar)};this.writeArrayOfDate=function(ar){I("Write","DATE",ar)};this.writeArrayOfDt=function(ar){I("Write","DT",ar)};this.writeArrayOfStruct=function(ar){I("Write","STRUCT",ar)};this.readArrayOfBool=function(ar){I("Read","BOOL",ar)};this.readArrayOfByte=function(ar){I("Read","BYTE",ar)};this.readArrayOfUsint=function(ar){I("Read","USINT",ar)};this.readArrayOfSint=function(ar){I("Read","SINT",ar)};this.readArrayOfWord=function(ar){I("Read","WORD",ar)};this.readArrayOfUint=function(ar){I("Read","UINT",ar)};this.readArrayOfInt=function(ar){I("Read","INT",ar)};this.readArrayOfInt1Dp=function(ar){I("Read","INT1DP",ar)};this.readArrayOfDword=function(ar){I("Read","DWORD",ar)};this.readArrayOfUdint=function(ar){I("Read","UDINT",ar)};this.readArrayOfDint=function(ar){I("Read","DINT",ar)};this.readArrayOfReal=function(ar){I("Read","REAL",ar)};this.readArrayOfLreal=function(ar){I("Read","LREAL",ar)};this.readArrayOfString=function(ar){I("Read","STRING",ar)};this.readArrayOfTime=function(ar){I("Read","TIME",ar)};this.readArrayOfTod=function(ar){I("Read","TOD",ar)};this.readArrayOfDate=function(ar){I("Read","DATE",ar)};this.readArrayOfDt=function(ar){I("Read","DT",ar)};this.readArrayOfStruct=function(ar){I("Read","STRUCT",ar)};function ad(){var ar={method:"Read",indexGroup:k.UploadInfo,indexOffset:0,reqDescr:{readLength:8,}};u(ar).send()}function Z(ax){var ar,at,ay,av,au;try{ar=ax.xmlHttpReq.responseXML.documentElement;at=T(ar.getElementsByTagName("ppData")[0].firstChild.data);ay=at.substr(0,4);b=Y(ay,"DWORD");ay=at.substr(4,4);v=Y(ay,"DWORD")}catch(aw){j("TAME library error: Parsing of UploadInfo failed:"+aw);return}au={method:"Read",indexGroup:k.Upload,indexOffset:0,reqDescr:{readLength:v,}};u(au).send()}function ag(aJ){var ar,aB=0,aG=4,aD=8,az=12,aw=30,av,ax,aI,aA,aC,at,aH,ay,au,aF;try{ar=aJ.xmlHttpReq.responseXML.documentElement;av=T(ar.getElementsByTagName("ppData")[0].firstChild.data);for(aA=0;aA<b;aA++){ax=av.substr(aB,4);aC=Y(ax,"DWORD");at=av.substring(aB+aw,(aB+aC)).split(String.fromCharCode(0));name=at[0].toUpperCase();R[name]={typeString:at[1],indexGroup:Y(av.substr(aB+aG,4),"DWORD"),indexOffset:Y(av.substr(aB+aD,4),"DWORD"),size:Y(av.substr(aB+az,4),"DWORD")};aH=at[1].split(" ");if(aH[0]==="ARRAY"){R[name].type=aH[0];ay=aH[1].substring(1,aH[1].length-1);ay=ay.split("..");R[name].arrStartIdx=parseInt(ay[0],10);ay=parseInt(ay[1],10)-parseInt(ay[0],10)+1;R[name].arrayLength=ay;au=aH[3].split("(");if(au[1]!==undefined){au[1]=au[1].substr(0,au[1].length-1);R[name].fullType=aH[0]+"."+ay+"."+au[0]+"."+au[1];R[name].stringLength=parseInt(au[1],10)}else{R[name].fullType=aH[0]+"."+ay+"."+au[0]}R[name].itemSize=R[name].size/ay;R[name].arrayDataType="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(au[0]===aF){R[name].arrayDataType=au[0]}}}if(R[name].arrayDataType==="USER"){R[name].dataType=au[0]}}else{au=aH[0].split("(");if(au[1]!==undefined){au[1]=au[1].substr(0,au[1].length-1);R[name].fullType=au[0]+"."+au[1];R[name].stringLength=parseInt(au[1],10)}else{R[name].fullType=au[0]}R[name].type="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(au[0]===aF){R[name].type=au[0]}}}if(R[name].type==="USER"){R[name].dataType=au[0]}}aB+=aC}ac.symTableReady=true;j("TAME library info: End of fetching the symbols.");j("TAME library info: Symbol table ready.");if(e.syncXmlHttp!==true){an()}}catch(aE){j("TAME library error: Parsing of uploaded symbol information failed:"+aE);return}}function J(){var av=ab(),aB=[],at,ar,aA,ax,aw,az,au,ay;j("TAME library info: Start reading the TPY file.");av.open("GET",e.configFileUrl,!e.syncXmlHttp,e.serviceUser,e.servicePassword);av.setRequestHeader("Content-Type","text/xml");av.onreadystatechange=function(){if((av.readyState===4)&&(av.status===200)){if(typeof DOMParser=="function"){try{at=(new DOMParser()).parseFromString(av.responseText,"text/xml")}catch(aH){j("TAME library error: Creating a DOM object from TPY failed:"+aH);return}}else{j("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(typeof e.amsNetId!=="string"||typeof e.amsPort!=="string"||a===0){j("TAME library info: Start reading the service information from the TPY file.");try{A={netId:at.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:at.getElementsByTagName("Port")[0].childNodes[0].nodeValue};ay=at.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(ay==="2"){A.alignment=parseInt(at.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(ay==="3"){A.alignment=8}else{j("TAME library error: Could not determine the TwinCAT version.")}}j("TAME library info: End of reading the service information from the TPY file.")}catch(aH){j("TAME library error: An error occured while reading service information from the TPY file:");j(aH)}}else{j("TAME library info: NetId, port and alignment manually set. Skip reading the service information from the TPY file.")}if(e.forceUploadUsage!==true){j("TAME library info: Start reading the symbols from the TPY file.");try{aA=at.getElementsByTagName("Symbols")[0];aB=aA.getElementsByTagName("Symbol");for(var aD=0;aD<aB.length;aD++){ar=aB[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();R[ar]={typeString:aB[aD].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(aB[aD].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(aB[aD].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(aB[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};R[ar].size=(R[ar].bitSize>=8)?R[ar].bitSize/8:R[ar].bitSize;ax=R[ar].typeString.split(" ");if(ax[0]==="ARRAY"){R[ar].type=ax[0];aw=ax[1].substring(1,ax[1].length-1);aw=aw.split("..");R[ar].arrStartIdx=parseInt(aw[0],10);aw=parseInt(aw[1],10)-parseInt(aw[0],10)+1;R[ar].arrayLength=aw;az=ax[3].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);R[ar].fullType=ax[0]+"."+aw+"."+az[0]+"."+az[1];R[ar].stringLength=parseInt(az[1],10)}else{R[ar].fullType=ax[0]+"."+aw+"."+az[0]}R[ar].itemSize=R[ar].size/aw;R[ar].arrayDataType="USER";for(au in C){if(C.hasOwnProperty(au)){if(az[0]===au){R[ar].arrayDataType=az[0]}}}if(R[ar].arrayDataType==="USER"){R[ar].dataType=az[0]}}else{az=ax[0].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);R[ar].fullType=az[0]+"."+az[1];R[ar].stringLength=parseInt(az[1],10)}else{R[ar].fullType=az[0]}R[ar].type="USER";for(au in C){if(C.hasOwnProperty(au)){if(az[0]===au){R[ar].type=az[0]}}}if(R[ar].type==="USER"){R[ar].dataType=az[0]}}}ac.symTableReady=true;j("TAME library info: End of reading the symbols from the TPY file.");j("TAME library info: Symbol table ready.")}catch(aH){j("TAME library error: An error occured while parsing the symbol file:");j(aH)}}else{j("TAME library info: Reading the symbols from the TPY file is deactivated.")}var aE,aF,aJ,aG,aI;if(true){j("TAME library info: Start reading the data types from the TPY file.");try{aE=at.getElementsByTagName("DataTypes")[0];aF=aE.getElementsByTagName("DataType");for(var aD=0;aD<aF.length;aD++){aI=aF[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ar=aI.split(" ")[0];if(ar==="ARRAY"){aq[aI]={bitSize:parseInt(aF[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};aq[aI].size=aq[aI].bitSize/8}}for(var aD=0;aD<aF.length;aD++){aI=aF[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ar=aI.split(" ")[0];if(ar!=="ARRAY"){aq[ar]={bitSize:parseInt(aF[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};aq[ar].size=aq[ar].bitSize/8;aJ=aF[aD].getElementsByTagName("SubItem");for(var aC=0;aC<aJ.length;aC++){aG=aJ[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aq[ar].subItems[aG]={typeString:aJ[aC].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:aJ[aC].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(aJ[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(aJ[aC].getElementsByTagName("BitOffs")[0]!==undefined){aq[ar].subItems[aG].bitOffset=parseInt(aJ[aC].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}aq[ar].subItems[aG].size=(aq[ar].subItems[aG].bitSize>=8)?aq[ar].subItems[aG].bitSize/8:aq[ar].subItems[aG].bitSize;ax=aq[ar].subItems[aG].typeString.split(" ");if(ax[0]==="ARRAY"){aq[ar].subItems[aG].type=ax[0];aw=ax[1].substring(1,ax[1].length-1);aw=aw.split("..");aq[ar].subItems[aG].arrStartIdx=parseInt(aw[0],10);aw=parseInt(aw[1],10)-parseInt(aw[0],10)+1;aq[ar].subItems[aG].arrayLength=aw;az=ax[3].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);aq[ar].subItems[aG].fullType=ax[0]+"."+aw+"."+az[0]+"."+az[1];aq[ar].subItems[aG].stringLength=parseInt(az[1],10)}else{aq[ar].subItems[aG].fullType=ax[0]+"."+aw+"."+az[0]}aq[ar].subItems[aG].bitSize=aq[aq[ar].subItems[aG].typeString].bitSize;aq[ar].subItems[aG].size=aq[aq[ar].subItems[aG].typeString].size;aq[ar].subItems[aG].itemSize=aq[ar].subItems[aG].size/aw;aq[ar].subItems[aG].arrayDataType="USER";for(au in C){if(C.hasOwnProperty(au)){if(az[0]===au){aq[ar].subItems[aG].arrayDataType=az[0]}}}if(aq[ar].subItems[aG].arrayDataType==="USER"){aq[ar].subItems[aG].dataType=az[0]}}else{az=ax[0].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);aq[ar].subItems[aG].fullType=az[0]+"."+az[1];aq[ar].subItems[aG].stringLength=parseInt(az[1],10)}else{aq[ar].subItems[aG].fullType=az[0]}aq[ar].subItems[aG].type="USER";for(au in C){if(C.hasOwnProperty(au)){if(az[0]===au){aq[ar].subItems[aG].type=az[0]}}}if(aq[ar].subItems[aG].type==="USER"){aq[ar].subItems[aG].dataType=az[0]}}}}}ac.dataTypeTableReady=true;j("TAME library info: End of reading the data types from the TPY file.");j("TAME library info: Data type table ready.");w()}catch(aH){j("TAME library error: An error occured while creating the data type information:");j("Type: "+aI);j("SubItem: "+aG);j(aH)}}}};av.send(null)}function t(){if(typeof e.amsNetId!=="string"){e.amsNetId=A.netId;j("TAME library info: No NetId definition found. NetId from TPY file will be used.")}if(typeof e.amsPort!=="string"){e.amsPort=A.port;j("TAME library info: No AMS port definition found. Port number from TPY file will be used.")}if(a===0){if(A.alignment!==undefined){a=A.alignment;j("TAME library info: No alignment parameter found. Alignment from TPY file will be used.")}else{a=1;j("TAME library warning: Can't get a value for the data aligment. Default value for alignment is used (1). This works only with TC2 and x86 processors.")}}if(a!==1&&a!==4&&a!==8){j("TAME library warning: The value for the alignment should be 1, 4 or 8.")}j("TAME library info: Target information: NetId: "+e.amsNetId+", AMS port: "+e.amsPort+" , alignment: "+a)}function w(){t();if(typeof e.configFileUrl!="string"||e.forceUploadUsage===true){j("TAME library info: Start fetching the symbols from PLC.");try{ad()}catch(ar){j("TAME library error: Could'nt fetch the symbol information from the PLC:"+ar);return}}else{if(e.syncXmlHttp!==true){an()}}}function an(){if(typeof e.onReady=="function"){j('TAME library info: Calling the "onReady" function.');e.onReady()}else{j('TAME library error: No "onReady" function defined. Check the manual.')}}if(e.dontFetchSymbols===true){j("TAME library warning: Reading of the UploadInfo and the TPY file deactivated. Symbol Table could not be created.");if(a!==1&&a!==4&&a!==8){j("TAME library warning: The value for the alignment should be 1, 4 or 8.")}j("TAME library info: Target information: NetId: "+e.amsNetId+", AMS port: "+e.amsPort+" , alignment: "+a);if(e.syncXmlHttp!==true){window.setTimeout(an,1)}}else{if(typeof e.configFileUrl=="string"){j("TAME library info: Fetching the TPY file from the webserver.");J()}else{w()}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};